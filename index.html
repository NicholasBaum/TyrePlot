<head>
    <script src="https://cdn.plot.ly/plotly-2.24.2.min.js" charset="utf-8"></script>
</head>

<body>
    <div>
        <input type="file" id="fileInput">
        <select id="channelComboBox"></select>
    </div>
    <div id="plotElement"></div>
    <script>
        let channels;
        const input = document.getElementById('fileInput');
        const cb = document.getElementById('channelComboBox');
        input.addEventListener('change', function (event) {
            const file = event.target.files[0];
            loadCSVFile(file, function (data) {
                channels = data;
                fillComboBox();
            })

        })
        cb.addEventListener('change', function (event) {
            render(event.target.value)
        })


        function render(channel) {
            Plotly.newPlot("plotElement", /* JSON object */ {
                "data": [{ "y": channels[channel] }],
                "layout": { "width": 600, "height": 400 }
            })
        }

        function fillComboBox() {
            cb.innerHTML = '';
            console.log('filling combo box')
            Object.keys(channels).forEach(function (key) {
                console.log(key)
                const opt = document.createElement('option');
                opt.text = key;
                opt.value = key;
                cb.appendChild(opt);
            });
        }

        function parseCSV(csvData) {
            const lines = csvData.split('\n');
            const headers = lines[0].split(',');
            const data = [];

            for (let j = 0; j < headers.length - 1; j++) {
                data[headers[j]] = [];
            }

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                for (let j = 0; j < values.length - 1; j++) {
                    if (j == 0) {
                        data[headers[j]][i - 1] = values[j];
                        continue;
                    }
                    data[headers[j]][i - 1] = parseFloat(values[j]);
                }
            }
            return data;
        }


        function loadCSVFile(file, callback) {
            const reader = new FileReader();
            reader.onload = function (event) {
                const csvData = event.target.result;
                const parsedData = parseCSV(csvData);
                callback(parsedData);
            };
            reader.readAsText(file);
        }

    </script>
</body>